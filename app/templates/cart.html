{% extends "base.html" %}

{% block content %}
<div class="container mx-auto mt-10">
    <h1 class="text-3xl font-bold text-center mb-6">üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h1>

    {% if cart_items %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for item in cart_items %}
            <div class="relative p-4 border rounded-lg shadow-md bg-white flex flex-col items-center">
                <img src="{{ url_for('static', path='images/' + item.product_id|string + '.webp') }}"
                     alt="–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞"
                     class="w-full h-40 object-contain rounded-md">

                <div class="text-center mt-2">
                    <h2 class="text-xl font-semibold">{{ item.name }}</h2>
                    <p class="text-gray-600 text-sm">{{ item.description }}</p>
                    <p class="text-lg font-bold mt-2">{{ item.price }} ‚ÇΩ x {{ item.quantity }}</p>
                    <p class="text-lg font-bold text-red-500">–í—Å–µ–≥–æ: {{ item.total_cost }} ‚ÇΩ</p>
                </div>

                <button onclick="removeFromCart({{ item.product_id }})"
                        class="btn__del j-basket-item-del absolute bottom-2 right-2">
                    üóë
                </button>
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-6">
            <button onclick="checkout()" class="bg-green-500 text-white px-6 py-3 rounded-lg text-lg">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </div>
    {% else %}
        <p class="text-center text-lg text-gray-600">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –µ—â—ë –ø—É—Å—Ç–∞, –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã</p>
    {% endif %}
</div>

<script>
    async function removeFromCart(productId) {
        const response = await fetch(`/cart/remove/${productId}`, { method: 'DELETE' });
        if (response.ok) {
            console.log(`–¢–æ–≤–∞—Ä —Å ID ${productId} —É–¥–∞–ª–µ–Ω`);
            location.reload();
        } else {
            alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞!");
        }
    }
</script>>

<script>
    async function checkout() {
    const response = await fetch("/orders/checkout", {
        method: "POST",
        credentials: "include"
    });

    if (response.ok) {
        window.location.href = "/pages/products";
    } else {
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞.");
    }
}
</script>

<style>
    .btn__del {
        background-color: transparent;
        border: none;
        font-size: 22px; /* –†–∞–∑–º–µ—Ä –∏–∫–æ–Ω–∫–∏ */
        cursor: pointer;
        transition: transform 0.2s, color 0.2s;
    }

    .btn__del:hover {
        color: #cc0000;
        transform: scale(1.2); /* –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    }
</style>
{% endblock %}